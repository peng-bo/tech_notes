<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-6bb82d3b-9054-44ea-b3e6-b926d3471b80"></attachment><h1>介绍</h1><p>一般我们需要进行日志分析场景：直接在日志文件中 grep、awk 就可以获得自己想要的信息。但在规模较大的场景中，此方法效率低下，面临问题包括日志量太大如何归档、文本搜索太慢怎么办、如何多维度查询。需要集中化的日志管理，所有服务器上的日志收集汇总。常见解决思路是建立集中式日志收集系统，将所有节点上的日志统一收集，管理，访问。</p><p>一般大型系统是一个分布式部署的架构，不同的服务模块部署在不同的服务器上，问题出现时，大部分情况需要根据问题暴露的关键信息，定位到具体的服务器和服务模块，构建一套集中式日志系统，可以提高定位问题的效率。</p><p>一个完整的集中式日志系统，需要包含以下几个主要特点：</p><p><br></p><ul><li>收集－能够采集多种来源的日志数据</li><li>传输－能够稳定的把日志数据传输到中央系统</li><li>存储－如何存储日志数据</li><li>分析－可以支持 UI 分析</li><li>警告－能够提供错误报告，监控机制</li></ul><p>ELK提供了一整套解决方案，并且都是开源软件，之间互相配合使用，完美衔接，高效的满足了很多场合的应用。目前主流的一种日志系统。</p><p><br></p><h3>ELK简介：</h3><p><img src="//:0"></p><p>ELK是三个开源软件的缩写，分别表示：Elasticsearch , Logstash, Kibana , 它们都是开源软件。新增了一个FileBeat，它是一个轻量级的日志收集处理工具(Agent)，Filebeat占用资源少，适合于在各个服务器上搜集日志后传输给Logstash，官方也推荐此工具。</p><p>Elasticsearch是个开源分布式搜索引擎，提供搜集、分析、存储数据三大功能。它的特点有：分布式，零配置，自动发现，索引自动分片，索引副本机制，restful风格接口，多数据源，自动搜索负载等。</p><p>Logstash 主要是用来日志的搜集、分析、过滤日志的工具，支持大量的数据获取方式。一般工作方式为c/s架构，client端安装在需要收集日志的主机上，server端负责将收到的各节点日志进行过滤、修改等操作在一并发往elasticsearch上去。</p><p>Kibana 也是一个开源和免费的工具，Kibana可以为 Logstash 和 ElasticSearch 提供的日志分析友好的 Web 界面，可以帮助汇总、分析和搜索重要数据日志。</p><p>Filebeat ：轻量级数据收集引擎。基于原先 Logstash-fowarder 的源码改造出来。换句话说：Filebeat就是新版的 Logstash-fowarder，也会是 ELK Stack 在 shipper 端的第一选择。</p><p><br></p><h4>简单版架构</h4><h4><img src="//:0"></h4><p>这种架构下我们把 Logstash 实例与 Elasticsearch 实例直接相连。Logstash 实例直接通过 Input 插件读取数据源数据(比如 Java 日志， Nginx 日志等)，经过 Filter 插件进行过滤日志，最后通过 Output 插件将数据写入到 ElasticSearch 实例中。</p><p>这个阶段，日志的收集、过滤、输出等功能，主要由这三个核心组件组成 Input 、Filter、Output</p><p>Input：输入，输入数据可以是 File 、 Stdin（直接从控制台输入） 、TCP、Syslog 、Redis 、Collectd 等</p><p>Filter：过滤，将日志输出成我们想要的格式。Logstash 存在丰富的过滤插件：Grok 正则捕获、时间处理、JSON 编解码、数据修改 Mutate 。Grok 是 Logstash 中最重要的插件，强烈建议每个人都要使用 Grok Debugger 来调试自己的 Grok 表达式</p><p>Output：输出，输出目标可以是 Stdout （直接从控制台输出）、Elasticsearch 、Redis 、TCP 、File 等</p><p>这是最简单的一种ELK架构方式，Logstash 实例直接与 Elasticsearch 实例连接。优点是搭建简单，易于上手。建议供初学者学习与参考，不能用于线上的环境。</p><p><br></p><h4>集群版架构</h4><h4><img src="//:0"></h4><p>这种架构下我们采用多个 Elasticsearch 节点组成 Elasticsearch 集群，由于 Logstash 与 Elasticsearch 采用集群模式运行，集群模式可以避免单实例压力过重的问题，同时在线上各个服务器上部署 Logstash Agent，来满足数据量不大且可靠性不强的场景。</p><p>如果想了解更多架构组合，请参考文章：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Ftoutiao.io%2Fposts%2F7fvyci%2Fpreview" target="_blank">https://toutiao.io/posts/7fvyci/preview</a></p><p>  后续文章主要使用filebeat+logstash+es+kibana架构讲解</p><p><img src="//:0"></p><hr><p>以下版本信息</p><pre class="ql-syntax" spellcheck="false">filebeat: 7.4.1
es: 7.4.1
logstash: 7.4.1
kibana: 7.4.1
</pre><p>Filebeat快速部署：<a href="https://www.jianshu.com/p/c7cc4091d1d1" target="_blank">https://www.jianshu.com/p/c7cc4091d1d1</a></p><p> Elasticsearch快速部署：<a href="https://www.jianshu.com/p/910e83880f98" target="_blank">https://www.jianshu.com/p/910e83880f98</a></p><p> Logstash快速部署：<a href="https://www.jianshu.com/p/42fd8f965db1" target="_blank">https://www.jianshu.com/p/42fd8f965db1</a></p><p> Kibana快速部署：<a href="https://www.jianshu.com/p/459b5b6551da" target="_blank">https://www.jianshu.com/p/459b5b6551da</a></p><p><br></p><p><br></p><p>作者：水饺鲜生</p><p>链接：https://www.jianshu.com/p/441298d8a9f6</p><p><br></p>